# CLAUDE.md - Elephant Network Data Submitter Web App

This document provides context for AI assistants (like Claude) to understand and work with the Elephant Network Data Submitter web application effectively.

## Project Overview

The Elephant Network Data Submitter is a React-based web application that:

- Provides a web interface for the Elephant CLI functionality
- Connects to MetaMask wallet for blockchain interaction
- Uploads CSV files containing data hashes generated by the CLI
- Submits data hashes to the Elephant Network smart contract on Polygon
- Handles transaction batching for efficient gas usage
- Includes browser compatibility checks and user guidance

## Key Technical Stack

### Frontend Framework
- **React 19** with TypeScript
- **Vite** for build tooling and development server
- **Tailwind CSS v4** with custom brand colors and @theme directive
- **ethers.js v6** for blockchain interaction
- **Papaparse** for CSV file parsing

### Development Tools
- **ESLint** for code linting
- **Prettier** for code formatting
- **TypeScript** with strict mode for type safety

### Deployment
- **Netlify** with automatic builds and SPA routing
- **Node.js 18** runtime environment

## Architecture Overview

### Component Structure
```
src/
├── components/
│   ├── CsvUploader.tsx          # CSV file upload and parsing
│   ├── MetaMaskButton.tsx       # MetaMask connection with real logo
│   └── UnsupportedBrowser.tsx   # Browser compatibility screen
├── hooks/
│   └── useMetaMask.ts           # MetaMask wallet integration
├── services/
│   └── transactionBatcher.ts   # Batch transaction handling
├── utils/
│   └── browserDetection.ts     # Browser compatibility detection
├── types/
│   └── contract.types.ts        # TypeScript type definitions
├── config/
│   └── constants.ts             # Configuration constants
└── App.tsx                      # Main application component
```

### Key Services

1. **TransactionBatcherService**: Handles batching data submissions to optimize gas costs
2. **useMetaMask Hook**: Manages wallet connection, network switching, and account state
3. **Browser Detection**: Identifies supported/unsupported browsers and provides guidance

## Smart Contract Integration

### Contract Details
- **Contract Address**: `0x79D5046e34D4A56D357E12636A18da6eaEfe0586` (Polygon mainnet)
- **Network**: Polygon (Chain ID: 137)
- **Gas Token**: POL (formerly MATIC)
- **Batch Size**: Default 200 items per transaction (configurable)

### CSV Data Format
The web app expects CSV files with these columns:
- `propertyCid`: Property CID identifier
- `dataGroupCid`: Data group CID  
- `dataCid`: Individual data CID

Generated by: `elephant-cli validate-and-upload ./data --output-csv results.csv`

## Brand Colors and Design System

### Color Palette
All colors are defined in `src/index.css` using Tailwind CSS v4 @theme directive:

```css
@theme {
  /* Brand Colors with 5 opacity levels */
  --color-brand-green-100: rgb(43 231 134);      /* Primary brand green */
  --color-brand-green-80: rgb(43 231 134 / 0.8);
  --color-brand-green-60: rgb(43 231 134 / 0.6);
  --color-brand-green-40: rgb(43 231 134 / 0.4);
  --color-brand-green-20: rgb(43 231 134 / 0.2);

  --color-brand-charcoal-100: rgb(66 62 62);     /* Dark text */
  --color-brand-storm-100: rgb(94 92 92);        /* Medium text */
  --color-brand-white-100: rgb(255 255 255);     /* Pure white */
  --color-brand-offwhite-100: rgb(240 240 240);  /* Light background */
}
```

### Usage in Classes
- `bg-brand-green-100` - Primary green background
- `text-brand-charcoal-100` - Dark text
- `text-brand-storm-100` - Secondary text
- `border-brand-green-60` - Green borders
- `hover:bg-brand-green-80` - Hover states

## Browser Compatibility

### Supported Browsers
- ✅ **Chrome** (Recommended) - Full MetaMask support
- ✅ **Firefox** - Full MetaMask support  
- ✅ **Edge** (Chromium-based) - Full MetaMask support
- ✅ **Opera** - Chromium-based, supports MetaMask

### Unsupported Browsers
- ❌ **Safari** - MetaMask not available
- ❌ **Internet Explorer** - Deprecated
- ❌ **Samsung Internet** - Limited Web3 support

### Browser Detection Logic
Located in `src/utils/browserDetection.ts`:
- Detects browser type and version from user agent
- Returns `isSupported` boolean for compatibility checks
- Shows `UnsupportedBrowser` component for incompatible browsers

## User Flow and UX

### Step-by-Step Process
1. **Browser Check**: Automatic detection and redirect if unsupported
2. **Wallet Connection**: MetaMask installation/connection with network switching
3. **CSV Upload**: File validation and data preview
4. **Transaction Submission**: Batch processing with progress tracking
5. **Result Display**: Transaction hashes and Polygonscan links

### Key UX Features
- **Progressive Disclosure**: Steps revealed as user progresses
- **Clear Instructions**: Explanatory text for each section
- **Error Handling**: Specific error messages for common issues
- **Loading States**: Progress indicators during transactions
- **Responsive Design**: Works on desktop and mobile

## Configuration Options

### URL Parameters
- `?configuration=true` - Shows advanced configuration panel

### Advanced Settings
- **Contract Address**: Customizable smart contract address
- **Batch Size**: Number of items per transaction (1-500, default 200)

### Environment Variables
For Netlify deployment:
- `NODE_VERSION=18`
- `NODE_ENV=production`

## Development Workflow

### Commands
```bash
# Development
npm run dev          # Start development server
npm run build        # Build for production
npm run preview      # Preview production build

# Code Quality
npm run lint         # ESLint code checking
npm run format       # Format all files with Prettier
npm run format:check # Check formatting without changes
```

### File Watching
- Vite provides hot module replacement (HMR)
- Automatic browser refresh on file changes
- TypeScript compilation on save

## Common Issues and Solutions

### 1. MetaMask Connection Issues
- **Problem**: MetaMask not detected
- **Solution**: Check browser compatibility, ensure MetaMask is installed
- **Code**: `useMetaMask.ts` handles detection and provides install URLs

### 2. Network Issues
- **Problem**: User on wrong network
- **Solution**: `switchToPolygon()` function automatically switches
- **UI**: Warning message with switch button

### 3. CSV Format Issues
- **Problem**: Invalid CSV structure
- **Solution**: `CsvUploader.tsx` validates columns and shows format requirements
- **Error Handling**: Specific error messages for missing columns

### 4. Browser Compatibility
- **Problem**: Safari users can't access MetaMask
- **Solution**: `UnsupportedBrowser.tsx` component with browser download links
- **Detection**: `browserDetection.ts` identifies browser type

### 5. Transaction Failures
- **Problem**: Gas estimation or submission errors
- **Solution**: `TransactionBatcherService` handles retries and error reporting
- **UI**: Detailed error messages and transaction status

## Integration with Elephant CLI

### Relationship
- **CLI Tool**: Validates data and uploads to IPFS, generates CSV
- **Web App**: Reads CSV and submits hashes to blockchain
- **Workflow**: CLI first, then web app for final submission

### CSV File Format
Must contain exact column names:
```csv
propertyCid,dataGroupCid,dataCid
QmXXX...,QmYYY...,QmZZZ...
```

### Data Flow
1. CLI: `validate-and-upload` command creates CSV
2. User: Downloads CSV file
3. Web App: Uploads CSV file
4. Web App: Parses and validates CSV structure
5. Web App: Submits to smart contract via MetaMask

## Security Considerations

### Web3 Security
- **Private Keys**: Never handled by the app (MetaMask only)
- **Transaction Signing**: All done through MetaMask interface
- **Network Validation**: Ensures Polygon network before transactions

### Input Validation
- **CSV Validation**: Checks file structure and required columns
- **Address Validation**: Contract address format checking
- **Parameter Limits**: Batch size restrictions (1-500)

### Headers and Policies
Configured in `netlify.toml`:
- XSS Protection
- Content-Type validation
- Frame denial (prevents embedding)
- CORS headers for Web3 compatibility

## Assets and Branding

### Logos and Icons
- **Favicon**: Custom SVG with Elephant Network branding (`public/favicon.svg`)
- **Vertical Logo**: Elephant Network logo (`public/vertical-logo-gray.svg`)
- **MetaMask Icon**: Real MetaMask fox logo (embedded SVG)

### External Links
- **Homepage**: https://elephant.xyz
- **Whitepaper**: https://elephant.xyz/whitepaper
- **Polygonscan**: Transaction links for result verification

## Testing Strategy

### Manual Testing Checklist
1. **Browser Compatibility**: Test on Chrome, Firefox, Edge, Safari
2. **MetaMask Integration**: Install, connect, network switching
3. **CSV Upload**: Valid/invalid files, error handling
4. **Transaction Flow**: Batch submission, gas estimation, confirmations
5. **Responsive Design**: Desktop and mobile layouts

### Error Scenarios to Test
- MetaMask not installed
- Wrong network (not Polygon)
- Invalid CSV format
- Transaction rejection
- Network connectivity issues
- Insufficient gas/POL balance

## Performance Optimizations

### Build Optimizations
- **Vite**: Fast build tool with tree shaking
- **Code Splitting**: Automatic chunk splitting
- **Asset Optimization**: Image and SVG compression

### Runtime Optimizations
- **Lazy Loading**: Components loaded on demand
- **Memoization**: React hooks for expensive operations
- **Batch Processing**: Efficient transaction batching

### Caching Strategy
Configured in `netlify.toml`:
- **Static Assets**: 1 year cache (immutable)
- **HTML Files**: No cache (for updates)
- **Service Worker**: No cache (for functionality)

## Future Enhancement Opportunities

### Feature Additions
1. **Transaction History**: Store and display past submissions
2. **Gas Price Estimation**: Real-time gas price suggestions
3. **Multi-network Support**: Support for other EVM chains
4. **Drag & Drop Upload**: Enhanced file upload UX
5. **Progress Persistence**: Resume interrupted uploads

### Technical Improvements
1. **Unit Testing**: Jest/Vitest test suite
2. **E2E Testing**: Playwright automation
3. **Error Monitoring**: Sentry integration
4. **Analytics**: User behavior tracking
5. **PWA Features**: Offline capability

### UX Enhancements
1. **Dark Mode**: Theme switching
2. **Language Support**: Internationalization
3. **Accessibility**: WCAG compliance improvements
4. **Mobile App**: React Native version
5. **Desktop App**: Electron wrapper

## Deployment and CI/CD

### Netlify Configuration
File: `netlify.toml`
- **Build Command**: `npm ci && npm run format:check && npm run lint && npm run build`
- **Publish Directory**: `dist`
- **Node Version**: 18
- **SPA Routing**: Redirects all routes to index.html

### Branch Strategy
- **Production**: Main branch auto-deploys
- **Preview**: PR branches get deploy previews
- **Development**: Feature branches for testing

### Quality Gates
1. **Prettier**: Code formatting check
2. **ESLint**: Code quality and standards
3. **TypeScript**: Type checking compilation
4. **Build Success**: Vite production build

## Monitoring and Maintenance

### Key Metrics to Monitor
1. **Build Success Rate**: Netlify deployment status
2. **User Errors**: Browser console errors
3. **Transaction Success**: MetaMask interaction rates
4. **Performance**: Page load times and bundle size

### Regular Maintenance Tasks
1. **Dependency Updates**: npm audit and updates
2. **Browser Testing**: New browser version compatibility
3. **Gas Price Monitoring**: Polygon network fee changes
4. **Contract Verification**: Smart contract status checks

## Documentation and Resources

### Internal Documentation
- `DEPLOY.md` - Deployment instructions
- `README.md` - Basic project information
- `package.json` - Dependencies and scripts
- `.prettierrc` - Code formatting rules

### External Resources
- [Elephant Network](https://elephant.xyz) - Protocol documentation
- [MetaMask Docs](https://docs.metamask.io) - Wallet integration
- [Ethers.js Docs](https://docs.ethers.org) - Blockchain library
- [Polygon Docs](https://docs.polygon.technology) - Network information
- [Tailwind CSS](https://tailwindcss.com) - Styling framework

### CLI Integration
- Related CLI tool: `../` (parent directory)
- CLI documentation: `../CLAUDE.md`
- Shared types and constants where applicable

## Version History and Changes

### Recent Major Changes
1. **Browser Compatibility**: Added detection and unsupported browser screen
2. **MetaMask Logo**: Replaced custom icon with official MetaMask branding
3. **Brand Colors**: Implemented full Elephant Network color palette
4. **User Guidance**: Added step-by-step instructions and explanations
5. **Prettier Integration**: Code formatting with CI/CD checks

### Breaking Changes to Watch
- Tailwind CSS v4 syntax (different from v3)
- React 19 changes in hooks and lifecycle
- Ethers.js v6 API differences from v5
- MetaMask API changes and updates

This documentation should be updated whenever significant changes are made to the architecture, features, or development workflow.